<!DOCTYPE html>
<html lang="ko">
<head>
<meta name="viewport" content="width=1080, user-scalable=0">
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="title" content="thePAY" />
<meta name="description" content="" />
<meta name="keywords" content="" />
<meta name="author" content="" />
<meta name="image" content="" />
<meta property="og:type" content="website">
<meta property="og:title" content="thePAY">
<meta property="og:description" content="">
<meta property="og:image" content="">
<meta property="og:url" content="">
<title>thePAY</title>
<link rel="stylesheet" href="/assets/common/css/default.css?v=<?=date('YmdHis')?>">
<link rel="stylesheet" href="/assets/common/css/contents.css?v=<?=date('YmdHis')?>">
<link rel="stylesheet" href="/assets/common/css/custom.css?v=<?=date('YmdHis')?>">
<link rel="canonical" href="">
<link rel="shortcut icon" href="/assets/images/favicon.ico">
<!--[if lt IE 9]>
    <script src="/assets/common/js/html5shiv.js"></script>
<![endif]-->

<style>
    .hidden { display: none; }

    #POPUP_pg_confirm .popup__body,
    #POPUP_finish .popup__body { height: auto; padding: 60px 60px; }

    .select_intl.on a { border-left: 3px solid #7f8f9a !important; }
</style>
</head>
<body>
<!-- WRAP -->
<div id="WRAP" class="bg__gray">
</div>
<!-- //WRAP -->

<div id="template" class="hidden">
    <!-- HEADER -->
    <div id="HEADER" class="hidden">
        <header>
            <h1 class="head__text">{{activity_main_list_internation_call_content}}</h1>
            <button class="head__back"><img src="/assets/images/i_back.png" alt="뒤로"></button>
        </header>
    </div>
    <!-- //HEADER -->

    <!-- CONTAINER -->
    <div id="CONTAINER">
        <div id="FORM_PAGE">
            <div id="FORM_PAGE__CONTENT">

                <fieldset>
                    <div class="l__inner bg__white">
                        <div class="form-group form-group_col">
                            <label for="form_phone">{{recharge_number}}</label>
                            <div class="int_phone">
                                <input type="tel" name="form_phone" id="form_phone" class="int phone intFoc" autocomplete="off" placeholder="{{hint_recharge_number}}" value="{{user.ANI}}">
                                <a href="javascript:;" class="btn_Address" id=""><img src="/assets/images/i_address.png" alt="전화부 아이콘"></a>
                                <a href="javascript:;" class="btn_History2" id=""><img src="/assets/images/i_address2.png" alt="전화부 아이콘"></a>
                            </div>
                        </div>
                        <div class="form-group form-group_col">
                            <label for="form_product">{{recharge_goods}}</label>
                            <div class="tab_menu tabmenu_number">
                                <ul id="recharge_item" class="column col3">
                                    <li class="rate">
                                        <a href="javascript:;">
                                            <div class="tabmenu_inner tac">
                                                <div class="FT__title">RATE</div>
                                            </div>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="form_language">{{arslanguage_kt}}</label>
                            <select name="form_language" id="form_language" class="int">
                                <option value=""></option>
                            </select>
                        </div>
                        <div class="form-group bot">
                            <label for="form_amount">{{recharge_amount}}</label>
                            <select name="form_amount" id="form_amount" class="int">
                                <option value=""></option>
                            </select>
                        </div>
                    </div>
                    <!-- div class="line__bot"></div -->

                    <div class="l__inner payment_box">
                        <div class="BOX__line box__shadow bg__white">
                            <div class="BOX__line_row top">
                                <dl class="details_guide_col col_2">
                                    <dd class="details_col col1">
                                        <div class="FT__desc3 subcolor"><strong class="FW__L">{{amount}}</strong></div>
                                        <div class="FT__title4"><strong id="amount"></strong></div>
                                    </dd>
                                </dl>
                            </div>
                            <div class="padding_0 cash_top" style="display:none;">
                                <div class="hr"></div>
                            </div>
                            <div class="BOX__line_row" style="display:none;">
                                <dl class="details_guide_col col_2 checkbox_wrap">
                                    <dd class="details_col col1">
                                        <div class="FT__desc3 subcolor"><strong class="FW__L">{{recharge_thepay_cash}}</strong></div>
                                        <div class="FT__title2" id="user_cash">￦ {{user.displayCash}}</div>
                                    </dd>
                                    <dd class="details_col col2 tar">
                                        <div class="int_check">
                                            <input type="checkbox" id="use_cash" class="use_checkbox"> <label for="use_cash">{{recharge_use}} <span></span></label>
                                        </div>
                                    </dd>
                                </dl>
                            </div>
                            <div class="padding_0 point_top" style="display:none;">
                                <div class="hr"></div>
                            </div>
                            <div class="BOX__line_row" style="display:none;">
                                <dl class="details_guide_col col_2 checkbox_wrap">
                                    <dd class="details_col col1">
                                        <div class="FT__desc3 subcolor"><strong class="FW__L">{{recharge_point}}</strong></div>
                                        <div class="FT__title2" id="user_point">ⓟ {{user.displayPoint}}</div>
                                    </dd>
                                    <dd class="details_col col2 tar">
                                        <div class="int_check">
                                            <input type="checkbox" id="use_point" class="use_checkbox"> <label for="use_point">{{recharge_use}} <span></span></label>
                                        </div>
                                    </dd>
                                </dl>
                            </div>
                            <div class="BOX__line_row bot tac">
                                <div class="FT__title subcolor pad">{{recharge_pay_amount}}</div>
                                <div class="FT__title5 pad"><strong class="point2" id="payment_amount"></strong></div>
                                <div class="FT__desc2 subcolor pad">{{payment_min_amount}}</div>
                            </div>
                        </div>
                    </div>

                    <div class="fixed_btn">
                        <div class="fixed_height"></div>
                        <input type="submit" value="{{btn_recharge}}" class="btn" id="btn_recharge">
                    </div>
                </fieldset>

                <div class="l__popup" id="POPUP_dataCheck">
                    <div class="dim"></div>
                    <div class="l-table">
                        <div class="l-cell">
                            <div class="popup__wrap">
                                <!-- <div class="popup__head">
                                    <div class="popup__title tal">
                                        Recharge Amount
                                    </div>
                                </div> -->
                                <div class="popup__body">
                                    <div class="default_select_inner">
                                        <ul>
                                        </ul>
                                    </div>
                                </div>
                                <div class="popup__foot popup_btns col2">
                                    <a href="javascript:;" class="btn_ok popup__close">{{btn_cancel}}</a>
                                    <a href="javascript:;" class="btn btn_spinner_confirm">{{btn_confirm}}</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- pg confirm -->
                <div class="l__popup" id="POPUP_pg_confirm">
                    <div class="dim"></div>
                    <div class="l-table">
                        <div class="l-cell">
                            <div class="popup__wrap">
                                <div class="popup__head">
                                    <div class="popup__title">
                                        {{alert_title_confirm}}
                                    </div>
                                </div>
                                <div class="popup__body">
                                    <div class="l-table">
                                        <div class="l-cell">
                                            <div class="popup__desc FT__desc2">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="popup__foot popup_btns col2">
                                    <a href="javascript:;" class="btn_ok popup__close">{{btn_cancel}}</a>
                                    <a href="javascript:;" class="btn btn_pg_confirm">{{btn_confirm}}</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- // pg confirm -->

                <div class="l__popup" id="POPUP_finish">
                    <div class="dim"></div>
                    <div class="l-table">
                        <div class="l-cell">
                            <div class="popup__wrap">
                                <div class="popup__head">
                                    <div class="popup__title">
                                        {{alert_title_confirm}}
                                    </div>
                                </div>
                                <div class="popup__body">
                                    <div class="l-table">
                                        <div class="l-cell">
                                            <div class="popup__desc FT__desc2">
                                                {{alert_msg_recharge_sucess}}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="popup__foot">
                                    <a href="javascript:;" class="btn_ok btn_finish_confirm">{{btn_confirm}}</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div><!-- //LOGIN_PAGE__CONTENT -->
        </div>
    </div>
    <!-- //CONTAINER -->
</div>

<form id="send_form" method="GET" action="/recharge.html">
    <input type="hidden" id="mvnoId" name="mvnoId" value="">
    <input type="hidden" id="amt" name="amt" value="">
    <input type="hidden" id="payAmt" name="payAmt" value="">
    <input type="hidden" id="useCash" name="useCash" value="">
    <input type="hidden" id="usePoint" name="usePoint" value="">
    <input type="hidden" id="rcgType" name="rcgType" value="I">
    <input type="hidden" id="rcgSeq" name="rcgSeq" value="">
    <input type="hidden" id="opCode" name="opCode" value="">
    <input type="hidden" id="creditBillType" name="creditBillType" value="">
    <input type="hidden" id="ctn" name="ctn" value="">
    <input type="hidden" id="orderNum" name="orderNum" value="">
    <input type="hidden" id="pgId" name="pgId" value="">
    <input type="hidden" id="noticeContent" name="noticeContent">
    <input type="hidden" id="title" name="title" value="title_activity_pay_international">
</form>

<!-- 페이지 로딩시 LANG 처리하기 위하여 상단에서 로딩 -->
<script type="text/javascript" src="/assets/common/js/const.js?v=<?=date('YmdHis')?>"></script>
<script type="text/javascript" src="/assets/common/js/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="/assets/common/js/util.js?v=<?=date('YmdHis')?>"></script>
<script type="text/javascript" src="/assets/common/js/moment.js"></script>
<script>
var date = moment().format('HHmmss');
var commonPath = '/assets/common/js/common.js?v=' + date;
var apiPath = '/assets/common/js/api.js?v=' + date;
var bridgePath = '/assets/common/js/bridge.js?v=' + date;
util.loadDynamicScript(commonPath);
util.loadDynamicScript(bridgePath);
util.loadDynamicScript(apiPath);
</script>
<script type="text/javascript" src="/assets/common/js/mustache.min.js"></script>
<script type="text/javascript">
var _intlList = [];
var _defaultTab = 0;
var _isFirstLoadTab = true;
function ajax_page_info(opCode) {
    var params = {
        opCode: opCode,
        ANI: COMM_DATA.ANI,
        USER_ID: COMM_DATA.USER_ID,
        pinNumber:COMM_DATA.pinNumber,
        LANG: COMM_DATA.LANG,
        TELCOM: COMM_DATA.TELCOM,
        MODEL: COMM_DATA.MODEL,
        APP_VER: COMM_DATA.APP_VER
    };

    api.subPreloadingAdr(params, function(res) {
        if (typeof res == 'string') res = JSON.parse(res);
        console.log(COMM_DATA, res);

        if (res['O_CODE'] == '0000') {
            var data = res['O_DATA'];

            if (data['mvnoList']) {
                if (opCode == 'intl') {
                    renderIntl(data['mvnoList']['intl']);

                    // after page action
                    if (_isFirstLoadTab) {
                        _isFirstLoadTab = false;
                        ajax_page_info('intlTab');
                    }
                }
                if (opCode == 'intlTab') selectIntlTab(data['mvnoList']['intlTab']);
            }
        } else {
            alert(res['O_MSG']);
        }
    });
}

function ajax_page_remains() {
    var eDate = moment().format('YYYYMMDDHHmmss');
    bridge.callEncParams({ ENC_DATE: eDate }, 
    function () {
        var params = {
            pinNumber: COMM_DATA.pinNumber,
            ANI: COMM_DATA.ANI,
            USER_ID: COMM_DATA.USER_ID,
            LANG: COMM_DATA.LANG,
            SESSION_ID: COMM_DATA.SESSION_ID,
            ENC_DATE: _ENC.ENC_DATE,
            AES256: _ENC.AES256
        };

        api.remains(params, function(res) {
            if (res['O_CODE'] == '0000') {
                var data = res['O_DATA'];

                COMM_DATA.cash = data.cash;
                COMM_DATA.point = data.point;

                /* 가지고 있는 포인트가 금액보다 크면 금액만큼만 표시 */
                renderPoint();
            } else {
                alert(res['O_MSG']);
                // history.back();
            }
        });
    });
}

// PG 유효성 체크
function ajax_pg_rcg() {
    var eDate = moment().format('YYYYMMDDHHmmss');
    bridge.callEncParams({ ENC_DATE: eDate },
    function() {
        var phone = util.getNum($('#form_phone').val());
        var langCd = $('#form_language option:selected').val();
        var mvnoId = $('#mvnoId').val();
        var rcgType = $('#rcgType').val();
        var rcgAmt = parseInt(util.getNum($('#amt').val()));
        var useCash = parseInt(util.getNum($('#useCash').val()));
        var usePoint = parseInt(util.getNum($('#usePoint').val()));
        var payAmt =  rcgAmt - useCash - usePoint; // parseInt(util.getNum($('#payAmt').val()));
        var params = {
            opCode: 'NOTICE', 
            pinNumber: COMM_DATA.pinNumber,
            CTN: phone,
            ANI: COMM_DATA.ANI,
            // langCd: langCd,
            LANG: langCd,
            osLang: COMM_DATA.osLang,
            SESSION_ID: COMM_DATA.SESSION_ID,
            ENC_DATE: _ENC.ENC_DATE,
            AES256: _ENC.AES256,
            rcgType: rcgType,
            mvnoId: mvnoId,
            rcgAmt: rcgAmt,
            userCash: useCash,
            userPoint: usePoint,
            payAmt: payAmt
        };

        api.rcgV2(params, function(res) {
            if (typeof res == 'string') res = JSON.parse(res);

            if (res['O_CODE'] == '0000') {
                var data = res['O_DATA'];
                var popup = $('#POPUP_pg_confirm');
                console.log(data);

                // 리턴 결과 값에 따라서 변동
                $('#ctn').val(phone);
                $('#rcgSeq').val(data['O_RCG_SEQ']);
                $('#opCode').val(data['O_OP_CODE']);
                $('#creditBillType').val(data['O_CREDIT_BILL_TYPE']);
                $('#orderNum').val(data['O_ORDERNUM']);
                $('#pgId').val(data['O_PG_ID']);
                $('#noticeContent').val(data['O_NOTIECE_CONTENT']);

                // 팝업 값 셋팅
                popup.find('.popup__desc').html(data['O_NOTIECE_CONTENT']);

                if (phone) {
                    bridge.callAddChargeNumHistory({
                        ctn: phone,
                        date: _ENC.ENC_DATE
                    });
                }

                // 장애등 사유로 충전이 불가할때
                // if (data['O_CHARGE_FLAG'] == 'N') {
                // }

                // DAOU 결제
                if (payAmt > 0 && (data['O_CREDIT_BILL_TYPE'] == 11 || data['O_CREDIT_BILL_TYPE'] == 12)) { 
                    bridgeDaou();
                    return false;
                }

                // Y 면 즉시 충전, N 이면 PG 결제
                if (data['O_PAY_FLAG'] == 'Y') {
                    setPop(popup, true);
                } else {
                    $('#send_form').submit();
                }

            } else {
                alert(res['O_MSG']);
                // history.back();
            }
        });
    });
}

function bridgeDaou(data) {
    var rcgSeq = $('#rcgSeq').val();
    var billType = $('#creditBillType').val();
    var opCode = $('#opCode').val();
    var orderNum = $('#orderNum').val();
    var pgId = $('#pgId').val();
    var noticeContent = $('#noticeContent').val();
    var ctn = $('#ctn').val();
    var mvnoId = $('#mvnoId').val();
    var rcgType = $('#rcgType').val();
    var rcgAmt = parseInt(util.getNum($('#amt').val()));
    var useCash = parseInt(util.getNum($('#useCash').val()));
    var usePoint = parseInt(util.getNum($('#usePoint').val()));
    var payAmt =  rcgAmt - useCash - usePoint;
    var mobileOS = util.getMobileOS();
    var obj = {
        pinNumber: COMM_DATA.pinNumber,
        CTN: ctn,
        USER_ID: COMM_DATA.USER_ID,
        LANG: COMM_DATA.LANG,
        SESSION_ID: COMM_DATA.SESSION_ID,
        ENC_DATE: moment().format('YY-MM-DD HH:mm:ss'),
        OS: (mobileOS == 'and' ? 'ADR':'IOS'),
        appType: 'thePAY',
        ANI: COMM_DATA.ANI,
        opCode: opCode,
        rcgSeq: rcgSeq,
        rcgType: rcgType,
        rcgAmt: rcgAmt,
        payAmt: payAmt,
        CREDIT_BILL_TYPE: billType,
        ORDERNUM: orderNum,
        PG_ID: pgId,
        noti_content: noticeContent
    };
    var urlParams = Object.keys(obj).map(function(k) {
                return (k) + '=' + (obj[k]);
            }).join('&');
    console.log(urlParams);

    bridge.callGetEncDaouParams({ params: urlParams }, ajax_pg_daou);
}

function ajax_pg_daou(res) {
    // alert('callback');
    // testConsole(JSON.stringify(params))
    api.authCardPaymentDaou(res.params, function(res) {
        if (res['O_CODE'] == '0000') {
            goBack();
        } else {
            alert(res['O_MSG']);
        }
    });
}

// PG 캐시 충전
function ajax_pg_cash() {
    var eDate = moment().format('YYYYMMDDHHmmss');
    bridge.callEncParams({ ENC_DATE: eDate }, function() {
        if (!_ENC) return alert('ENC error');
        var phone = util.getNum($('#form_phone').val());
        var mvnoId = $('#mvnoId').val();
        var rcgType = $('#rcgType').val();
        var rcgSeq = $('#rcgSeq').val();
        var opCode = $('#opCode').val();
        var rcgAmt = parseInt(util.getNum($('#amt').val()));
        var useCash = parseInt(util.getNum($('#useCash').val()));
        var usePoint = parseInt(util.getNum($('#usePoint').val()));
        var payAmt =  0;
        var params = {
            rcgSeq: rcgSeq,
            rcgMode: 'CASH',
            opCode: opCode, 
            pinNumber: COMM_DATA.pinNumber,
            CTN: phone,
            ANI: COMM_DATA.ANI,
            LANG: COMM_DATA.LANG,
            osLang: COMM_DATA.osLang,
            SESSION_ID: COMM_DATA.SESSION_ID,
            ENC_DATE: _ENC.ENC_DATE,
            AES256: _ENC.AES256,
            rcgType: rcgType,
            rcgAmt: rcgAmt,
            payAmt: 0
        };

        api.rcgCash(params, function(res) {
            if (res['O_CODE'] == '0000') {
                $('#POPUP_pg_confirm').hide();
                var popup = $('#POPUP_finish');
                setPop(popup, true);
            } else {
                alert(res['O_MSG']);
            }
        });
    });
}

function renderIntl(intlList) {
    if ($.isArray(intlList)) {
        console.log('intlList', intlList);
        _intlList = intlList;
        var target = $('#recharge_item');
        var html = [];
        var tpl = '<li data-id="{{mvnoId}}" data-name="{{mvnoName}}" class="{{addClass}} select_intl">\
                        <a href="javascript:;">\
                            <div class="tabmenu_inner tac">\
                                <div class="FT__title">{{name}}</div>\
                            </div>\
                        </a>\
                    </li>';

        intlList.forEach(function(v, i) {
            if ((_defaultTab == 0 && i == 0) || v.mvnoId == _defaultTab) {
                v.addClass = 'on';
            } else v.addClass = 'off';
            v['name'] = util.getNum(v.mvnoName);

            html.push(util.setTemplateObj(tpl, v));
        });

        html.push('<li class="rate">\
                        <a href="javascript:;">\
                            <div class="tabmenu_inner tac">\
                                <div class="FT__title">'+_LANG.activity_call_rate+'</div>\
                            </div>\
                        </a>\
                    </li>');

        if (html.length) {
            target.html(html);

            // 기본 아이템 설정
            var item = target.find('.select_intl.on');
            selectIntl(item);

        } else target.empty();
    }
}

function renderLang(arsLang) {
    if ($.isArray(arsLang)) {
        console.log('arsLang', arsLang);
        var target = $('#form_language');
        var html = [];
        var tpl = '<option value="{{langCd}}" {{selected}}>{{langName}}</option>';
        
        arsLang.forEach(function(v, i) {
            if (i == 0) v.selected = 'seleced';
            else v.selected = '';

            html.push(util.setTemplateObj(tpl, v));
        });

        if (html.length) {
            target.html(html);

            // 기본 아이템 설정
            var langCd = target.find('option:selected').val();
            selectLang(langCd);

        } else target.empty();
    }
}

function renderAmount(amountList) {
    if ($.isArray(amountList)) {
        console.log(amountList);
        var target = $('#form_amount');
        var html = [];
        var tpl = '<option value="{{amount}}" {{selected}}>{{display_amount}}</option>';
        
        amountList.forEach(function(v, i) {
            if (i == 0) v.selected = 'seleced';
            else v.selected = '';

            v['display_amount'] = _LANG.won + ' ' + util.comma(v.amount);
            html.push(util.setTemplateObj(tpl, v));
        });

        if (html.length) {
            target.html(html);

            // 기본 아이템 설정
            var amount = target.find('option:selected').val();
            selectAmount(amount);

        } else target.empty();
    }
}

function selectIntl(item) {
    var mvnoId = item.data('id');

    console.log('select intl', mvnoId, item);

//    var intl = _intlList.find(function(intl) { return intl.mvnoId == mvnoId });
    // 낮은버전 코드수정
    var intl;
    $.each(_intlList, function(i,v) { 
        if(v.mvnoId == mvnoId) { intl = _intlList[i]; return false; }
    });

    if (!intl) return false;
    $('#mvnoId').val(mvnoId);

    renderLang(intl.arsLang);
    renderAmount(intl.amounts);
}

function selectLang(langCd) {
    console.log('langCd', langCd);
}

function selectAmount(amount) {
    $('#amount, #payment_amount').text('₩ ' + util.comma(amount));

    $('#amt').val(amount);
    $('#payAmt').val(amount);

    renderPoint();
}

function selectIntlTab(tabObj) {
    var target = $('#recharge_item');

    if (tabObj.SelectInternationalCallTab) {
        var item = target.find('.select_intl.on');
        var mvnoId = item.data('id');

        // 선택된 값이 다르면 선택
        if (mvnoId != tabObj.SelectInternationalCallTab) {
            target.find('.select_intl[data-id='+tabObj.SelectInternationalCallTab+']').click();
        }
    }

    if (tabObj.isVisibleOpenInternationalCallTab) {
        if (tabObj.isVisibleOpenInternationalCallTab == 'all') {
            target.find('.select_intl').show();
            target.addClass('col3').removeClass('col2');
        } else {
            target.find('.select_intl[data-id='+tabObj.isVisibleOpenInternationalCallTab+']')
                .show().siblings('.select_intl').hide();
            target.addClass('col2').removeClass('col3');
        }
    }
}

function setPageComm() {
    var params = util.getUrlParams();

    if (params['tab_type']) {
        _defaultTab = params['tab_type'];
        _isFirstLoadTab = false;
    }
}

function pageLoadInit() {
    // 모든 기능은 App으로 부터 기본 정보를 받은 후 진행
    bridge.callCommonParams(function() {
        commonInit(); // XML LANG load

        setPageComm();
        bridge.callSetWebViewTitle({
            title: _LANG.title_activity_pay_international
        });

        // mustache render
        pageInit();
        ajax_page_info('intl');
        ajax_page_remains();

        // after mustache render
        pageActionInit();
    });
}

// 페이지 이벤트 구현부
function pageActionInit() {
    // 뒤로 가기
    $('.head__back').on('click', function() {
        history.back();
    });

    // 팝업닫기
    $('.popup__close,.dim').on('click', function(e) {
        e.preventDefault();e.stopPropagation();
        setPop($('.l__popup'), false);
    });

    // 충전 상품 선택
    $(document).on('click', '.select_intl',function() {
        var $this = $(this);
        $this.addClass('on').removeClass('off').siblings('.select_intl')
            .removeClass('on')
            .addClass('off');

        selectIntl($this);
    });

    // ARS 선택
    $('#form_language').on('change', function() {
        var langCd = $(this).find('option:selected').val();

        selectLang(langCd);
    });

    // Amount 선택
    $('#form_amount').on('change', function() {
        var amount = $(this).find('option:selected').val();

        selectAmount(amount);
        $(window).scrollTop($('body').prop('scrollHeight'));
    });

    $(document).on('click', '.rate', function() { 
        var item = $('.select_intl.on');
        var mvnoId = item.data('id');
        var path = '';

        if (mvnoId == '192') {
            bridge.callSetWebViewTitle({
                title: _LANG.title_activity_rates
            });
//            path = 'https://thepay.010pay.co.kr/Pay010MobileApi/mobile_api/ktPosRate.do?lang=' + COMM_DATA.LANG;
			path = 'http://61.111.2.224:7943/rate/rate.php?mvno_id=skt';
//			path = 'https://thepayw.010pay.co.kr/rate/rate.php?mvno_id=skt';
        } else if (mvnoId == '193') {
            bridge.callSetWebViewTitle({
                title: _LANG.title_activity_rates_sk
            })
//            path = 'https://thepay.010pay.co.kr/Pay010MobileApi/mobile_api/pAppSkRate.do?lang=' + COMM_DATA.LANG;
			path = 'http://61.111.2.224:7943/rate/rate.php?mvno_id=kt';
//			path = 'https://thepayw.010pay.co.kr/rate/rate.php?mvno_id=kt';
        }

        if (path) {
            var child = window.open(path);
        }
    });

    var _isInput = false;
    var _isCallBrige = false;
    var _inputInterval = null;
    $('#form_phone').on('keyup input', function() {
        var phone = $(this).val().replace(/[^0-9]/g, "");

        if (phone.length > 11) {
            phone = phone.substr(0, 11);
        }

        phone = phone.replace(/(^0[0-9]{2})([0-9]{4})([0-9]{4})/,"$1-$2-$3").replace("--", "-");
        $(this).val(phone);

        if (util.getNum(phone).length >= 2) {
            _isInput = true;
        } else {
            _isInput = false;
        }
    });
    $('#form_phone').keyup();
    _isInput = false;

    // 충전 유효성 검사
    $('#btn_recharge').on('click', function() {
        var phone = $('#form_phone').val();
        var mvnoId = $('#mvnoId').val();
        var amt = $('#amt').val();
        var payAmt = $('#payAmt').val();

        if (!util.getNum(phone).length) {
            alert(_LANG.toast_empty_recharge_number);
            $('#form_phone').focus();
            return false;
        }

        if (!mvnoId || !amt) {
            alert(_LANG.toast_empty_recharge_number);
            return false;
        }
        ajax_pg_rcg();
    });

    // 충전 진행
    $('.btn_pg_confirm').on('click', function() {
        ajax_pg_cash();
    });

    $('.checkbox_wrap').on('click', function(e) {
        e.stopPropagation(); e.preventDefault();
        var target = $(this).find('input[type=checkbox]');
        var isChecked = target.prop('checked');

        if ($(this).find('.int_check').css('display') == 'none') return false;

        // 1개만 선택
        $('input[type=checkbox]:checked').prop('checked', false);
        target.prop('checked', !isChecked);

        if (target.prop('checked')) {
            if (target.attr('id') == 'use_point') {
                _userSelCash = 'point';
            } else {
                _userSelCash = 'cash';
            }
        }

        // payAmt 계산
        calcPayAmt();
    });

    $('.btn_Address').on('click', function (e) {
        var countryCode = 'kr';
        var tabType = 'commonContact';
        var pageType = 'charge';
        var dataType = 'num';
        var inputId = $(this).prevAll('input').attr('id');

        bridge.callGoToContact({
            countryCode: countryCode,
            tabType: tabType,
            pageType: pageType,
            dataType: dataType,
            inputId: inputId
        });
    });

    $('.btn_History2').on('click', function (e) {
        var countryCode = 'kr';
        var tabType = 'commonHistory';
        var pageType = 'charge';
        var dataType = 'num';
        var inputId = $(this).prevAll('input').attr('id');

        bridge.callGoToContact({
            countryCode: countryCode,
            tabType: tabType,
            pageType: pageType,
            dataType: dataType,
            inputId: inputId
        });
    });

    $('.btn_finish_confirm,#POPUP_finish .dim').on('click', function (e) {
        e.preventDefault(); e.stopPropagation();
        location.replace('/rcgHistory.html');
    });
}

$(function(){
    pageLoadInit();
});
</script>
</body>
</html>
